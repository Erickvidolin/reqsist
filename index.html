<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Requisição de Materiais</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, updateDoc, doc, onSnapshot, query, where, orderBy } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA2FvtO-b74SSPPCTPLXuNJdE8j_URIL-E",
            authDomain: "sistema-requisicao-df38d.firebaseapp.com",
            projectId: "sistema-requisicao-df38d",
            storageBucket: "sistema-requisicao-df38d.firebasestorage.app",
            messagingSenderId: "302372688890",
            appId: "1:302372688890:web:b1eae19b67c2e814108a43"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // Exportar para uso global
        window.firebase = {
            db,
            auth,
            collection,
            addDoc,
            getDocs,
            updateDoc,
            doc,
            onSnapshot,
            query,
            where,
            orderBy,
            signInWithEmailAndPassword,
            signOut,
            onAuthStateChanged
        };
    </script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3b82f6',
                        secondary: '#1e40af',
                        success: '#10b981',
                        warning: '#f59e0b',
                        danger: '#ef4444'
                    }
                }
            }
        }
    </script>
    <style>
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Tela de Login -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4 fade-in">
        <div class="bg-white rounded-xl card-shadow p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <i class="fas fa-boxes text-5xl text-primary mb-4"></i>
                <h1 class="text-2xl font-bold text-gray-800">Sistema de Requisição</h1>
                <p class="text-gray-600 mt-2">Faça login para continuar</p>
            </div>
            
            <form id="login-form">
                <div class="mb-4">
                    <label for="email" class="block text-gray-700 text-sm font-medium mb-2">E-mail</label>
                    <input type="email" id="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="seu@email.com" required>
                </div>
                
                <div class="mb-6">
                    <label for="password" class="block text-gray-700 text-sm font-medium mb-2">Senha</label>
                    <input type="password" id="password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Digite sua senha" required>
                </div>
                
                <button type="submit" class="w-full bg-primary text-white py-2 px-4 rounded-lg hover:bg-secondary transition duration-200 font-medium">Entrar</button>
            </form>
            
            <div class="mt-6 text-center text-sm text-gray-500">
                <p>Use credenciais válidas do Firebase Authentication</p>
            </div>
        </div>
    </div>

    <!-- Tela Principal (após login) -->
    <div id="main-screen" class="hidden min-h-screen">
        <!-- Cabeçalho -->
        <header class="bg-white card-shadow">
            <div class="container mx-auto px-4 py-4 flex justify-between items-center">
                <div class="flex items-center">
                    <i class="fas fa-boxes text-2xl text-primary mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-800">Sistema de Requisição</h1>
                </div>
                
                <div class="flex items-center space-x-4">
                    <span id="user-info" class="text-gray-700"></span>
                    <button id="logout-btn" class="bg-gray-200 text-gray-700 py-1 px-3 rounded-lg hover:bg-gray-300 transition duration-200">
                        <i class="fas fa-sign-out-alt mr-1"></i> Sair
                    </button>
                </div>
            </div>
            
            <!-- Navegação -->
            <nav class="bg-secondary">
                <div class="container mx-auto px-4">
                    <ul class="flex">
                        <li>
                            <a href="#" id="nav-requisicao" class="nav-link active text-white py-3 px-6 block font-medium">
                                <i class="fas fa-plus-circle mr-2"></i> Nova Requisição
                            </a>
                        </li>
                        <li>
                            <a href="#" id="nav-atendimento" class="nav-link text-white py-3 px-6 block font-medium">
                                <i class="fas fa-tasks mr-2"></i> Atendimento
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </header>

        <!-- Conteúdo Principal -->
        <main class="container mx-auto px-4 py-8">
            <!-- Tela de Requisição -->
            <div id="requisicao-screen" class="fade-in">
                <div class="bg-white rounded-xl card-shadow p-6 mb-8">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Nova Requisição de Material</h2>
                    
                    <form id="requisicao-form">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="requisitante" class="block text-gray-700 text-sm font-medium mb-2">Requisitante</label>
                                <input type="text" id="requisitante" class="w-full px-4 py-2 border border-gray-300 rounded-lg bg-gray-100" readonly>
                            </div>
                            
                            <div>
                                <label for="setor" class="block text-gray-700 text-sm font-medium mb-2">Setor</label>
                                <select id="setor" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" required>
                                    <option value="" disabled selected>Selecione o setor</option>
                                    <option value="Administração">Administração</option>
                                    <option value="Produção">Produção</option>
                                    <option value="Logística">Logística</option>
                                    <option value="TI">TI</option>
                                    <option value="RH">RH</option>
                                    <option value="Financeiro">Financeiro</option>
                                </select>
                            </div>
                            
                            <div>
                                <label for="material" class="block text-gray-700 text-sm font-medium mb-2">Material</label>
                                <input type="text" id="material" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" placeholder="Descrição do material" required>
                            </div>
                            
                            <div>
                                <label for="quantidade" class="block text-gray-700 text-sm font-medium mb-2">Quantidade</label>
                                <input type="number" id="quantidade" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" min="1" value="1" required>
                            </div>
                        </div>
                        
                        <div class="mt-6">
                            <label for="observacoes" class="block text-gray-700 text-sm font-medium mb-2">Observações</label>
                            <textarea id="observacoes" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary" rows="3" placeholder="Informações adicionais (opcional)"></textarea>
                        </div>
                        
                        <div class="mt-8 flex justify-end">
                            <button type="submit" class="bg-primary text-white py-2 px-6 rounded-lg hover:bg-secondary transition duration-200 font-medium">
                                <i class="fas fa-paper-plane mr-2"></i> Enviar Requisição
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Histórico de Requisições do Usuário -->
                <div class="bg-white rounded-xl card-shadow p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Minhas Requisições</h2>
                    <div id="user-requests" class="space-y-4">
                        <!-- As requisições do usuário serão carregadas aqui -->
                    </div>
                </div>
            </div>

            <!-- Tela de Atendimento (apenas para admin) -->
            <div id="atendimento-screen" class="hidden fade-in">
                <div class="bg-white rounded-xl card-shadow p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Atendimento de Requisições</h2>
                    
                    <div class="mb-6 flex flex-wrap gap-2">
                        <button class="filter-btn active bg-primary text-white py-1 px-3 rounded-lg text-sm" data-status="todos">Todos</button>
                        <button class="filter-btn bg-gray-200 text-gray-700 py-1 px-3 rounded-lg text-sm" data-status="pendente">Pendentes</button>
                        <button class="filter-btn bg-warning text-white py-1 px-3 rounded-lg text-sm" data-status="aprovado">Aprovados</button>
                        <button class="filter-btn bg-success text-white py-1 px-3 rounded-lg text-sm" data-status="entregue">Entregues</button>
                        <button class="filter-btn bg-danger text-white py-1 px-3 rounded-lg text-sm" data-status="negado">Negados</button>
                    </div>
                    
                    <div id="requests-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Os cards de requisição serão carregados aqui -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de Confirmação -->
    <div id="confirmation-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Confirmar Ação</h3>
            <p id="confirmation-message" class="text-gray-600 mb-6">Tem certeza que deseja prosseguir?</p>
            <div class="flex justify-end space-x-3">
                <button id="cancel-action" class="bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-300 transition duration-200">Cancelar</button>
                <button id="confirm-action" class="bg-primary text-white py-2 px-4 rounded-lg hover:bg-secondary transition duration-200">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        // Estado da aplicação
        const state = {
            currentUser: null,
            isAdmin: false,
            requests: [],
            currentFilter: 'todos',
            unsubscribeRequests: null
        };

        // Elementos da DOM
        const elements = {
            loginScreen: document.getElementById('login-screen'),
            mainScreen: document.getElementById('main-screen'),
            loginForm: document.getElementById('login-form'),
            emailInput: document.getElementById('email'),
            passwordInput: document.getElementById('password'),
            userInfo: document.getElementById('user-info'),
            logoutBtn: document.getElementById('logout-btn'),
            navRequisicao: document.getElementById('nav-requisicao'),
            navAtendimento: document.getElementById('nav-atendimento'),
            requisicaoScreen: document.getElementById('requisicao-screen'),
            atendimentoScreen: document.getElementById('atendimento-screen'),
            requisicaoForm: document.getElementById('requisicao-form'),
            requisitanteInput: document.getElementById('requisitante'),
            setorSelect: document.getElementById('setor'),
            materialInput: document.getElementById('material'),
            quantidadeInput: document.getElementById('quantidade'),
            observacoesTextarea: document.getElementById('observacoes'),
            userRequests: document.getElementById('user-requests'),
            requestsContainer: document.getElementById('requests-container'),
            confirmationModal: document.getElementById('confirmation-modal'),
            confirmationMessage: document.getElementById('confirmation-message'),
            cancelAction: document.getElementById('cancel-action'),
            confirmAction: document.getElementById('confirm-action')
        };

        // Inicialização
        document.addEventListener('DOMContentLoaded', function() {
            // Verificar estado de autenticação
            window.firebase.onAuthStateChanged(window.firebase.auth, (user) => {
                if (user) {
                    state.currentUser = user;
                    state.isAdmin = user.email === 'admin@empresa.com'; // Defina o email do admin aqui
                    showMainScreen();
                    setupRealtimeListener();
                } else {
                    showLoginScreen();
                }
            });

            // Event Listeners
            elements.loginForm.addEventListener('submit', handleLogin);
            elements.logoutBtn.addEventListener('click', handleLogout);
            elements.navRequisicao.addEventListener('click', () => showScreen('requisicao'));
            elements.navAtendimento.addEventListener('click', () => showScreen('atendimento'));
            elements.requisicaoForm.addEventListener('submit', handleNewRequest);
            elements.cancelAction.addEventListener('click', hideConfirmationModal);
            
            // Adicionar event listeners para os botões de filtro
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active', 'bg-primary'));
                    document.querySelectorAll('.filter-btn').forEach(b => {
                        if (b.dataset.status !== 'todos' && b.dataset.status !== 'pendente') {
                            b.classList.remove('text-white');
                        }
                    });
                    
                    this.classList.add('active', 'bg-primary');
                    if (this.dataset.status !== 'pendente') {
                        this.classList.add('text-white');
                    }
                    
                    state.currentFilter = this.dataset.status;
                    renderRequests();
                });
            });
        });

        // Configurar listener em tempo real para as requisições
        function setupRealtimeListener() {
            if (state.unsubscribeRequests) {
                state.unsubscribeRequests();
            }

            const q = window.firebase.query(
                window.firebase.collection(window.firebase.db, "requisicoes"),
                window.firebase.orderBy("timestamp", "desc")
            );

            state.unsubscribeRequests = window.firebase.onSnapshot(q, (querySnapshot) => {
                state.requests = [];
                querySnapshot.forEach((doc) => {
                    const request = doc.data();
                    request.id = doc.id;
                    state.requests.push(request);
                });
                
                // Atualizar as interfaces
                if (state.isAdmin && state.currentFilter === 'atendimento') {
                    renderRequests();
                }
                renderUserRequests();
            });
        }

        // Funções de manipulação de eventos
        async function handleLogin(e) {
            e.preventDefault();
            const email = elements.emailInput.value.trim();
            const password = elements.passwordInput.value.trim();
            
            if (email && password) {
                try {
                    await window.firebase.signInWithEmailAndPassword(window.firebase.auth, email, password);
                    // O onAuthStateChanged irá lidar com o redirecionamento
                } catch (error) {
                    alert('Erro no login: ' + error.message);
                }
            } else {
                alert('Por favor, preencha todos os campos.');
            }
        }

        async function handleLogout() {
            try {
                if (state.unsubscribeRequests) {
                    state.unsubscribeRequests();
                }
                await window.firebase.signOut(window.firebase.auth);
            } catch (error) {
                console.error('Erro ao fazer logout:', error);
            }
        }

        async function handleNewRequest(e) {
            e.preventDefault();
            
            const newRequest = {
                requisitante: state.currentUser.displayName || state.currentUser.email.split('@')[0],
                email: state.currentUser.email,
                setor: elements.setorSelect.value,
                material: elements.materialInput.value,
                quantidade: parseInt(elements.quantidadeInput.value),
                observacoes: elements.observacoesTextarea.value,
                data: new Date().toLocaleString('pt-BR'),
                timestamp: new Date(),
                status: 'pendente'
            };
            
            try {
                await window.firebase.addDoc(
                    window.firebase.collection(window.firebase.db, "requisicoes"), 
                    newRequest
                );
                
                // Limpar o formulário
                elements.requisicaoForm.reset();
                elements.quantidadeInput.value = 1;
                
                // Mostrar mensagem de sucesso
                alert('Requisição enviada com sucesso!');
            } catch (error) {
                console.error('Erro ao enviar requisição:', error);
                alert('Erro ao enviar requisição. Tente novamente.');
            }
        }

        // Funções de renderização
        function showLoginScreen() {
            elements.loginScreen.classList.remove('hidden');
            elements.mainScreen.classList.add('hidden');
            elements.emailInput.value = '';
            elements.passwordInput.value = '';
        }

        function showMainScreen() {
            elements.loginScreen.classList.add('hidden');
            elements.mainScreen.classList.remove('hidden');
            
            // Atualizar informações do usuário
            const displayName = state.currentUser.displayName || state.currentUser.email.split('@')[0];
            elements.userInfo.textContent = `Olá, ${displayName}`;
            elements.requisitanteInput.value = displayName;
            
            // Mostrar a tela apropriada
            if (state.isAdmin) {
                elements.navAtendimento.classList.remove('hidden');
                showScreen('atendimento');
            } else {
                elements.navAtendimento.classList.add('hidden');
                showScreen('requisicao');
            }
        }

        function showScreen(screen) {
            // Atualizar navegação
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active', 'bg-primary', 'bg-opacity-20');
            });
            
            if (screen === 'requisicao') {
                elements.requisicaoScreen.classList.remove('hidden');
                elements.atendimentoScreen.classList.add('hidden');
                elements.navRequisicao.classList.add('active', 'bg-primary', 'bg-opacity-20');
            } else if (screen === 'atendimento') {
                elements.requisicaoScreen.classList.add('hidden');
                elements.atendimentoScreen.classList.remove('hidden');
                elements.navAtendimento.classList.add('active', 'bg-primary', 'bg-opacity-20');
                renderRequests();
            }
        }

        function renderUserRequests() {
            const userRequests = state.requests.filter(req => req.email === state.currentUser.email);
            
            if (userRequests.length === 0) {
                elements.userRequests.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-inbox text-4xl mb-3"></i>
                        <p>Nenhuma requisição encontrada</p>
                    </div>
                `;
                return;
            }
            
            elements.userRequests.innerHTML = userRequests.map(request => `
                <div class="border border-gray-200 rounded-lg p-4">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-medium text-gray-800">${request.material}</h3>
                        <span class="status-badge ${getStatusClass(request.status)} text-xs py-1 px-2 rounded-full">${getStatusText(request.status)}</span>
                    </div>
                    <div class="text-sm text-gray-600 mb-1">
                        <span class="font-medium">Setor:</span> ${request.setor}
                    </div>
                    <div class="text-sm text-gray-600 mb-1">
                        <span class="font-medium">Quantidade:</span> ${request.quantidade}
                    </div>
                    <div class="text-sm text-gray-600 mb-1">
                        <span class="font-medium">Data:</span> ${request.data}
                    </div>
                    ${request.observacoes ? `<div class="text-sm text-gray-600 mt-2">
                        <span class="font-medium">Observações:</span> ${request.observacoes}
                    </div>` : ''}
                </div>
            `).join('');
        }

        function renderRequests() {
            let filteredRequests = state.requests;
            
            // Aplicar filtro
            if (state.currentFilter !== 'todos') {
                filteredRequests = state.requests.filter(req => req.status === state.currentFilter);
            }
            
            if (filteredRequests.length === 0) {
                elements.requestsContainer.innerHTML = `
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-inbox text-5xl mb-4"></i>
                        <p class="text-lg">Nenhuma requisição encontrada</p>
                    </div>
                `;
                return;
            }
            
            elements.requestsContainer.innerHTML = filteredRequests.map(request => `
                <div class="bg-white border border-gray-200 rounded-xl card-shadow overflow-hidden">
                    <div class="p-4 border-b border-gray-200">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-gray-800 text-lg">${request.material}</h3>
                            <span class="status-badge ${getStatusClass(request.status)} text-xs py-1 px-2 rounded-full">${getStatusText(request.status)}</span>
                        </div>
                        <div class="text-sm text-gray-600 mb-1">
                            <i class="fas fa-user mr-1"></i> ${request.requisitante}
                        </div>
                        <div class="text-sm text-gray-600 mb-1">
                            <i class="fas fa-building mr-1"></i> ${request.setor}
                        </div>
                        <div class="text-sm text-gray-600">
                            <i class="fas fa-calendar mr-1"></i> ${request.data}
                        </div>
                    </div>
                    
                    <div class="p-4">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-sm text-gray-600">Quantidade:</span>
                            <span class="font-medium">${request.quantidade}</span>
                        </div>
                        
                        ${request.observacoes ? `
                        <div class="mb-4">
                            <span class="text-sm text-gray-600 block mb-1">Observações:</span>
                            <p class="text-sm bg-gray-50 p-2 rounded">${request.observacoes}</p>
                        </div>
                        ` : ''}
                        
                        <div class="flex space-x-2 mt-4">
                            ${request.status === 'pendente' ? `
                            <button class="flex-1 bg-success text-white py-2 px-3 rounded-lg text-sm hover:bg-green-700 transition duration-200 approve-btn" data-id="${request.id}">
                                <i class="fas fa-check mr-1"></i> Aprovar
                            </button>
                            <button class="flex-1 bg-danger text-white py-2 px-3 rounded-lg text-sm hover:bg-red-700 transition duration-200 deny-btn" data-id="${request.id}">
                                <i class="fas fa-times mr-1"></i> Negar
                            </button>
                            ` : ''}
                            
                            ${request.status === 'aprovado' ? `
                            <button class="flex-1 bg-success text-white py-2 px-3 rounded-lg text-sm hover:bg-green-700 transition duration-200 complete-btn" data-id="${request.id}">
                                <i class="fas fa-check-double mr-1"></i> Entregue
                            </button>
                            <button class="flex-1 bg-gray-200 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-300 transition duration-200 pendent-btn" data-id="${request.id}">
                                <i class="fas fa-undo mr-1"></i> Reabrir
                            </button>
                            ` : ''}
                            
                            ${request.status === 'entregue' || request.status === 'negado' ? `
                            <button class="flex-1 bg-gray-200 text-gray-700 py-2 px-3 rounded-lg text-sm hover:bg-gray-300 transition duration-200 pendent-btn" data-id="${request.id}">
                                <i class="fas fa-undo mr-1"></i> Reabrir
                            </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Adicionar event listeners aos botões
            document.querySelectorAll('.approve-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showConfirmationModal('Deseja aprovar esta requisição?', () => {
                        updateRequestStatus(this.dataset.id, 'aprovado');
                    });
                });
            });
            
            document.querySelectorAll('.deny-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showConfirmationModal('Deseja negar esta requisição?', () => {
                        updateRequestStatus(this.dataset.id, 'negado');
                    });
                });
            });
            
            document.querySelectorAll('.complete-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showConfirmationModal('Confirmar entrega do material?', () => {
                        updateRequestStatus(this.dataset.id, 'entregue');
                    });
                });
            });
            
            document.querySelectorAll('.pendent-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    showConfirmationModal('Deseja reabrir esta requisição?', () => {
                        updateRequestStatus(this.dataset.id, 'pendente');
                    });
                });
            });
        }

        async function updateRequestStatus(id, status) {
            try {
                const requestRef = window.firebase.doc(window.firebase.db, "requisicoes", id);
                await window.firebase.updateDoc(requestRef, {
                    status: status
                });
                // O listener em tempo real irá atualizar automaticamente a interface
            } catch (error) {
                console.error('Erro ao atualizar requisição:', error);
                alert('Erro ao atualizar requisição. Tente novamente.');
            }
        }

        function showConfirmationModal(message, confirmCallback) {
            elements.confirmationMessage.textContent = message;
            elements.confirmationModal.classList.remove('hidden');
            
            // Remover event listeners anteriores
            elements.confirmAction.replaceWith(elements.confirmAction.cloneNode(true));
            elements.confirmAction = document.getElementById('confirm-action');
            
            // Adicionar novo event listener
            elements.confirmAction.addEventListener('click', function() {
                confirmCallback();
                hideConfirmationModal();
            });
        }

        function hideConfirmationModal() {
            elements.confirmationModal.classList.add('hidden');
        }

        // Funções auxiliares
        function getStatusClass(status) {
            switch(status) {
                case 'pendente': return 'bg-warning text-white';
                case 'aprovado': return 'bg-primary text-white';
                case 'entregue': return 'bg-success text-white';
                case 'negado': return 'bg-danger text-white';
                default: return 'bg-gray-200 text-gray-700';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'pendente': return 'Pendente';
                case 'aprovado': return 'Aprovado';
                case 'entregue': return 'Entregue';
                case 'negado': return 'Negado';
                default: return status;
            }
        }
    </script>
</body>
</html>